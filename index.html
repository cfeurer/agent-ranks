<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agent Ranks — Confidential Agent Matching (Standalone Demo v2)</title>
  <style>
    :root { --bg:#fff; --fg:#0f172a; --muted:#475569; --border:#e2e8f0; --accent:#111827; --soft:#f8fafc; --shadow:0 1px 2px rgba(0,0,0,.06), 0 2px 8px rgba(0,0,0,.06); --radius:14px; }
    *{ box-sizing:border-box } html,body{ height:100%; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji" }
    a{ color:var(--accent); text-decoration:none } a:hover{ text-decoration:underline }
    .container{ max-width:1100px; margin:0 auto; padding:0 16px } .btn{ background:var(--accent); color:#fff; border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer }
    .btn[disabled]{ opacity:.5; cursor:not-allowed } .btn-outline{ background:#fff; color:var(--fg); border:1px solid var(--border) } .chip{ display:inline-block; background:#eef2ff; color:#1f2937; padding:6px 10px; border-radius:999px; font-size:12px }
    .card{ background:#fff; border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow) } .section{ padding:64px 0 }
    .h1{ font-size:40px; line-height:1.1; font-weight:800; letter-spacing:-.02em } .h2{ font-size:28px; font-weight:800; letter-spacing:-.02em } .h3{ font-size:16px; font-weight:800 }
    .muted{ color:var(--muted) } .row{ display:grid; grid-template-columns:1fr; gap:16px } @media(min-width:700px){ .row-2{ grid-template-columns:repeat(2,1fr) } .row-3{ grid-template-columns:repeat(3,1fr) } }
    header{ position:sticky; top:0; background:rgba(255,255,255,.8); backdrop-filter:blur(8px); border-bottom:1px solid var(--border); z-index:50 } nav a{ margin-right:16px; font-size:14px; color:#111827 }
    .hero{ position:relative; overflow:hidden } .pill{ display:inline-flex; padding:6px 12px; border-radius:999px; border:1px solid rgba(17,24,39,.15); background:rgba(17,24,39,.03); font-size:12px; font-weight:700 }
    .hero-visual{ height:320px; border-radius:var(--radius); border:1px solid var(--border); overflow:hidden; position:relative } .slide{ position:absolute; inset:0; display:flex; justify-content:space-between; align-items:flex-end; padding:24px; color:#fff; transition:opacity .6s }
    .badge{ display:inline-flex; transform:rotate(-6deg); border:2px solid rgba(255,255,255,.7); background:rgba(255,255,255,.15); padding:6px 10px; border-radius:12px; font-weight:900; letter-spacing:.18em; font-size:11px }
    .shadow{ box-shadow:var(--shadow) } .progress{ height:8px; width:180px; background:#f1f5f9; border-radius:999px; overflow:hidden } .progress>div{ height:100%; background:#111827 }
    .input,.textarea{ width:100%; border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-size:14px } .grid-2{ display:grid; grid-template-columns:1fr; gap:12px } @media(min-width:700px){ .grid-2{ grid-template-columns:repeat(2,1fr) } }
    .grid-3{ display:grid; grid-template-columns:1fr; gap:12px } @media(min-width:700px){ .grid-3{ grid-template-columns:repeat(3,1fr) } } .list{ list-style:disc; padding-left:18px } .small{ font-size:12px } .xsmall{ font-size:11px; color:#64748b }
    .pillbar{ display:flex; gap:8px; flex-wrap:wrap } .hidden{ display:none } .modal{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; padding:16px; z-index:100 }
    .tabular{ font-variant-numeric:tabular-nums } .footer{ border-top:1px solid var(--border); background:#fff } #chat-fab{ position:fixed; right:18px; bottom:18px; z-index:60 }
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; padding:14px 16px;">
      <div style="display:flex; align-items:center; gap:10px;">
        <div style="width:32px; height:32px; border-radius:12px; background:linear-gradient(135deg,#6366f1,#a855f7,#f43f5e);"></div>
        <strong>Agent Ranks</strong>
      </div>
      <nav class="hide-mobile">
        <a href="#how">How it works</a><a href="#questionnaire">Get matched</a><a href="#mortgage">Mortgage & Insurance</a><a href="#admin">Data (pilot)</a><a href="#faq">FAQ</a><a href="#contact">Contact</a>
      </nav>
      <a href="#questionnaire" class="btn">Find my best match</a>
    </div>
  </header>

  <main>
    <section class="section hero">
      <div class="container row row-2">
        <div>
          <span class="pill">Agent Ranks • Confidential • Unbiased</span>
          <h1 class="h1" style="margin-top:12px;">Find your best-fit real estate agent — privately</h1>
          <p class="muted" style="margin-top:8px; max-width: 600px;">
            50+ matching signals (neighborhood, product type, price band, buyer/seller focus, marketing power, track record).
            We present your best 3 matches — with no names or contact shared until <em>both</em> sides opt-in.
          </p>
          <div style="display:flex; gap:10px; margin-top:16px;">
            <a class="btn" href="#questionnaire">Start 2-minute match</a>
            <a class="btn btn-outline" href="#how">How it works</a>
          </div>
          <div class="card" style="margin-top:16px; padding:12px 14px; background:#111827; color:#fff;">
            <div id="testi-quote" style="font-size:14px;">“We met three great options anonymously and chose the one who sold our place in 11 days.”</div>
            <div id="testi-who" class="xsmall" style="color:#cbd5e1; margin-top:4px;">— Seller in West Loop</div>
          </div>
        </div>
        <div>
          <div class="hero-visual shadow">
            <div class="slide" id="slide0" style="opacity:1; background: radial-gradient(800px 600px at 20% 20%, rgba(255,255,255,.25), transparent), linear-gradient(135deg, #1e3a8a, #7c3aed, #be185d);">
              <div>
                <div class="badge">SOLD</div>
                <div style="font-size:18px; font-weight:800; text-shadow:0 1px 2px rgba(0,0,0,.5); margin-top:8px;">Accepted over ask</div>
                <div class="small" style="opacity:.9;">Bucktown • SFH • 11 days</div>
              </div>
              <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end; font-size:11px;">
                <div class="chip" style="background: rgba(255,255,255,.15); color:#fff; border:1px solid rgba(255,255,255,.35);">Anonymous chat ready</div>
                <div class="chip" style="background: rgba(255,255,255,.15); color:#fff; border:1px solid rgba(255,255,255,.35);">No contact shared</div>
                <div class="chip" style="background: rgba(255,255,255,.15); color:#fff; border:1px solid rgba(255,255,255,.35);">Mutual opt-in</div>
              </div>
            </div>
            <div class="slide" id="slide1" style="opacity:0; background: radial-gradient(800px 600px at 80% 0%, rgba(255,255,255,.2), transparent), linear-gradient(135deg, #0ea5e9, #6366f1, #db2777);">
              <div>
                <div class="badge">UNDER CONTRACT</div>
                <div style="font-size:18px; font-weight:800; text-shadow:0 1px 2px rgba(0,0,0,.5); margin-top:8px;">Won first offer</div>
                <div class="small" style="opacity:.9;">Lincoln Park • Condo • $800k</div>
              </div>
            </div>
            <div class="slide" id="slide2" style="opacity:0; background: radial-gradient(800px 600px at 0% 100%, rgba(255,255,255,.2), transparent), linear-gradient(135deg, #2563eb, #9333ea, #e11d48);">
              <div>
                <div class="badge">PRIVATE</div>
                <div style="font-size:18px; font-weight:800; text-shadow:0 1px 2px rgba(0,0,0,.5); margin-top:8px;">Off-market preview</div>
                <div class="small" style="opacity:.9;">North Shore • Private showing</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="how" class="section">
      <div class="container">
        <h2 class="h2">How it works</h2>
        <p class="muted" style="margin-top:6px;">Unbiased, data-driven matches. Comfortable, private introductions.</p>
        <div class="row row-3" style="margin-top:16px;">
          <div class="card" style="padding:18px;"><div class="chip">1</div><div class="h3" style="margin-top:8px;">Tell us your goals</div><div class="small muted">Buyer or seller, neighborhood, property type, price band, timing, and key priorities.</div></div>
          <div class="card" style="padding:18px;"><div class="chip">2</div><div class="h3" style="margin-top:8px;">AI-assisted matching</div><div class="small muted">We weigh 50+ signals to rank agents most likely to achieve your outcome.</div></div>
          <div class="card" style="padding:18px;"><div class="chip">3</div><div class="h3" style="margin-top:8px;">Anonymous introductions</div><div class="small muted">Review short narratives for your top matches without exposing identity or contact info.</div></div>
          <div class="card" style="padding:18px;"><div class="chip">4</div><div class="h3" style="margin-top:8px;">Mutual opt-in & connect</div><div class="small muted">If you approve, we open a private chat. When both sides agree, we connect directly.</div></div>
        </div>
      </div>
    </section>

    <section id="questionnaire" class="section">
      <div class="container">
        <h2 class="h2">Get matched in under 2 minutes</h2>
        <p class="muted">We only share anonymized needs until you choose to connect.</p>
        <div class="card" style="margin-top:14px; padding:16px;">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div class="xsmall">Step <span id="step-num">1</span> of 6</div><div class="progress"><div id="progress-bar" style="width:16.66%"></div></div>
          </div>
          <div id="step-0" style="margin-top:12px;">
            <div class="h3">Are you buying or selling?</div>
            <div class="grid-2" style="margin-top:10px;">
              <button class="card" data-role="Buyer" style="padding:12px; text-align:left;"><div class="h3">Buyer</div><div class="small muted">We’ll prioritize negotiation and availability.</div></button>
              <button class="card" data-role="Seller" style="padding:12px; text-align:left;"><div class="h3">Seller</div><div class="small muted">We’ll prioritize marketing power and days-on-market.</div></button>
            </div>
          </div>
          <div id="step-1" class="hidden" style="margin-top:12px;">
            <div class="h3">What neighborhood or area?</div>
            <input id="input-location" class="input" placeholder="e.g., West Loop, Lincoln Park, Hinsdale">
            <div class="xsmall" style="margin-top:6px;">Tip: You can be specific (e.g., “Bucktown”) or broader (e.g., “North Shore”).</div>
          </div>
          <div id="step-2" class="hidden" style="margin-top:12px;">
            <div class="h3">Property type</div>
            <div class="grid-3" style="margin-top:10px;"><div id="property-types"></div></div>
          </div>
          <div id="step-3" class="hidden" style="margin-top:12px;">
            <div class="h3">Price range</div>
            <div class="grid-2" style="margin-top:10px;">
              <div><div class="xsmall">Min</div><input id="price-min" type="number" class="input" value="400000"></div>
              <div><div class="xsmall">Max</div><input id="price-max" type="number" class="input" value="1000000"></div>
            </div>
            <div class="xsmall" style="margin-top:6px;">Change later if you’re uncertain.</div>
          </div>
          <div id="step-4" class="hidden" style="margin-top:12px;"><div class="h3">What matters most?</div><div id="priorities" class="grid-2" style="margin-top:10px;"></div></div>
          <div id="step-5" class="hidden" style="margin-top:12px;">
            <div class="h3">Timing</div>
            <div class="grid-3" style="margin-top:10px;">
              <button class="card timing" data-val="0-3 months" style="padding:12px; text-align:left;">0-3 months</button>
              <button class="card timing" data-val="3-6 months" style="padding:12px; text-align:left;">3-6 months</button>
              <button class="card timing" data-val="6-12 months" style="padding:12px; text-align:left;">6-12 months</button>
            </div>
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:14px;">
            <button class="btn btn-outline" id="btn-back">Back</button><button class="btn" id="btn-next">Next</button><button class="btn hidden" id="btn-finish">See my matches</button>
          </div>
          <div class="xsmall" style="margin-top:8px;">Your details remain private. We only open a chat if you approve your matches and the agent agrees.</div>
        </div>
      </div>
    </section>

    <section id="results" class="section hidden">
      <div class="container">
        <h2 class="h2">Your best-fit matches</h2>
        <p class="muted">We highlight the top three based on your goals. You can still browse up to ten options.</p>
        <div id="top3" class="row row-3" style="margin-top:16px;"></div>
        <div style="margin-top:28px;"><div class="h3">Other relevant options</div><div id="rest" class="row row-3" style="margin-top:12px;"></div></div>
        <div class="card" style="margin-top:28px; padding:16px; background:#f8fafc;">
          <div class="h3">Mortgage & Insurance (optional)</div>
          <div class="small muted" style="margin-top:6px;">Prefer a lender or insurance broker style? We’ll factor that into your matches too.</div>
          <div class="row row-3" style="margin-top:12px;">
            <label class="small"><input type="checkbox"> I want a rate-shopper lender</label>
            <label class="small"><input type="checkbox"> I prefer concierge service</label>
            <label class="small"><input type="checkbox"> I need jumbo loan expertise</label>
          </div>
        </div>
      </div>
    </section>

    <section id="mortgage" class="section">
      <div class="container">
        <h2 class="h2">Mortgage & Insurance referrals</h2>
        <p class="muted">When you're ready, we can introduce you to vetted lenders and brokers based on your profile.</p>
        <div class="row row-3" style="margin-top:12px;">
          <div class="card" style="padding:16px;"><div class="h3">Rate-first lenders</div><div class="small muted">We’ll factor your preference into matching and keep your info private until you opt-in.</div><button class="btn" style="margin-top:10px;">Add to my matches</button></div>
          <div class="card" style="padding:16px;"><div class="h3">Concierge lenders</div><div class="small muted">We’ll factor your preference into matching and keep your info private until you opt-in.</div><button class="btn" style="margin-top:10px;">Add to my matches</button></div>
          <div class="card" style="padding:16px;"><div class="h3">Insurance brokers</div><div class="small muted">We’ll factor your preference into matching and keep your info private until you opt-in.</div><button class="btn" style="margin-top:10px;">Add to my matches</button></div>
        </div>
      </div>
    </section>

    <section id="admin" class="section">
      <div class="container">
        <h2 class="h2">Pilot data (CSV import) — Chicagoland</h2>
        <p class="muted">Paste a simple CSV to test with real-looking agent stats before MLS integration.</p>
        <div class="card" style="padding:16px; margin-top:12px;">
          <div class="small">Columns: <code>id, alias, neighborhoods (;), propertyTypes (;), priceMin, priceMax, focus, marketing, negotiation, transactions12m, resources (;), brokerageMarketing, domVsArea, spLpVsArea, buyDiscountVsArea</code></div>
          <textarea id="csv" class="textarea" rows="8" style="margin-top:10px;" placeholder="id,alias,neighborhoods,propertyTypes,priceMin,priceMax,focus,marketing,negotiation,transactions12m,resources,brokerageMarketing,domVsArea,spLpVsArea,buyDiscountVsArea
X1,West Loop Condo Pro,West Loop;River North,Condo;Loft,600000,1600000,Seller,5,3,48,3D Tours;Broker Events;Pro Video,5,-8,1.1,0
X2,North Shore Seller Strategist,Winnetka;Glencoe;Evanston;Wilmette,Single Family,900000,3500000,Seller,5,4,34,Staging;Aerial Video;Broker Network,5,-8,1.3,0
X3,First-Time Buyer Guide,Lincoln Square;Ravenswood;Logan Square,Condo;Townhome,300000,800000,Buyer,3,5,38,Lender Intros;Buyer Workshops;Offer Playbooks,4,0,0,1.0"></textarea>
          <div style="display:flex; gap:10px; align-items:center; margin-top:10px;"><button id="load-sample" class="btn btn-outline">Load sample</button><button id="import" class="btn">Import CSV</button><span id="status" class="xsmall"></span></div>
        </div>
      </div>
    </section>

    <section id="faq" class="section">
      <div class="container">
        <h2 class="h2">FAQ</h2>
        <div class="card" style="margin-top:12px;">
          <details open style="padding:12px 16px; border-bottom:1px solid var(--border);"><summary class="h3">Are you affiliated with any brokerage or agent?</summary><div class="small muted" style="margin-top:6px;">No. We are independent and unbiased. Agents only see high-level needs until both sides opt-in.</div></details>
          <details style="padding:12px 16px; border-bottom:1px solid var(--border);"><summary class="h3">Do you charge clients?</summary><div class="small muted" style="margin-top:6px;">No. We are paid by the agent only after a successful connection via a standard 25% referral fee.</div></details>
          <details style="padding:12px 16px;"><summary class="h3">What data powers the match?</summary><div class="small muted" style="margin-top:6px;">We use 50+ signals including neighborhood focus, property type, price band, buyer/seller orientation, track record, marketing resources, and more.</div></details>
        </div>
      </div>
    </section>

    <section id="contact" class="section">
      <div class="container row row-2">
        <div class="card" style="padding:16px;">
          <div class="h3">Send a message</div>
          <form onsubmit="return false" style="margin-top:10px;">
            <input class="input" placeholder="Email (optional)">
            <textarea class="textarea" rows="4" placeholder="Your note" style="margin-top:10px;"></textarea>
            <button class="btn" style="margin-top:10px;">Send</button>
          </form>
        </div>
        <div class="card" style="padding:16px;">
          <div class="h3">Privacy first</div>
          <div class="small muted" style="margin-top:6px;">We keep your details confidential. We will never sell your data. Anonymous by default; you choose when to reveal your identity.</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; padding:16px 0;">
      <div class="xsmall">© <span id="year"></span> Agent Ranks — Demo Concept</div>
      <div class="xsmall"><a href="#how">How it works</a> · <a href="#faq">FAQ</a> · <a href="#contact">Contact</a></div>
    </div>
  </footer>

  <!-- Floating chat toggle -->
  <button id="chat-fab" class="btn" title="Open chat">Chat</button>

  <!-- Chat Modal -->
  <div id="chat-modal" class="modal hidden" aria-hidden="true">
    <div class="card" role="dialog" aria-modal="true" style="width: min(720px, 100%); max-height: 80vh; display:flex; flex-direction:column;">
      <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid var(--border);">
        <div><div class="xsmall">Anonymous chat</div><div class="h3" id="chat-title">Agent</div></div>
        <div style="display:flex; gap:8px;"><button class="btn btn-outline" id="chat-min">Minimize</button><button class="btn btn-outline" id="chat-close">Close</button></div>
      </div>
      <div id="chat-messages" style="padding:12px; overflow:auto; height: 50vh;"></div>
      <div style="display:flex; gap:8px; padding:12px; border-top:1px solid var(--border);">
        <input id="chat-input" class="input" placeholder="Type a message…"><button class="btn" id="chat-send">Send</button>
      </div>
      <div class="xsmall" style="padding:10px 12px; border-top:1px solid var(--border);">By continuing, you agree to stay anonymous until both sides opt-in. If an agent accepts, they agree to a 25% referral fee via our standard agreement.</div>
    </div>
  </div>

  <script>
    /* Testimonials + slides */
    const TESTIMONIALS=[{quote:"We met three great options anonymously and chose the one who sold our place in 11 days.",who:"Seller in West Loop"},{quote:"The match understood we were first-time buyers in Lincoln Park at $800k. Perfect fit.",who:"Buyer in Lincoln Park"},{quote:"Zero awkward phone calls. Just a private chat until both sides said yes.",who:"Seller in Bucktown"}];
    let testiIdx=0; setInterval(()=>{ testiIdx=(testiIdx+1)%TESTIMONIALS.length; document.getElementById('testi-quote').textContent='“'+TESTIMONIALS[testiIdx].quote+'”'; document.getElementById('testi-who').textContent='— '+TESTIMONIALS[testiIdx].who; },4000);
    let slideIdx=0; setInterval(()=>{ const ids=['slide0','slide1','slide2']; slideIdx=(slideIdx+1)%ids.length; ids.forEach((id,i)=>{ const el=document.getElementById(id); el.style.opacity=(i===slideIdx?1:0); }); },3500);

    /* Mock data */
    let AGENTS=[
      {id:'A1',alias:'North Side Neighborhood Pro',neighborhoods:['Lincoln Park','Lakeview','Bucktown','Wicker Park'],propertyTypes:['Condo','Single Family','Townhome'],priceMin:500000,priceMax:1500000,focus:'Seller',marketing:5,negotiation:4,transactions12m:42,resources:['Staging','Pro Video','Paid Social'],brokerageMarketing:5,domVsArea:-7,spLpVsArea:1.2,buyDiscountVsArea:0.1},
      {id:'A2',alias:'Downtown High-Rise Specialist',neighborhoods:['West Loop','River North','Loop'],propertyTypes:['Condo','Loft'],priceMin:600000,priceMax:2000000,focus:'Seller',marketing:5,negotiation:3,transactions12m:55,resources:['3D Tours','In-Building Network','Broker Events'],brokerageMarketing:5,domVsArea:-9,spLpVsArea:0.8,buyDiscountVsArea:0.0},
      {id:'A3',alias:'First-Time Buyer Guide',neighborhoods:['Lincoln Square','Ravenswood','Avondale','Logan Square'],propertyTypes:['Condo','Townhome'],priceMin:300000,priceMax:800000,focus:'Buyer',marketing:3,negotiation:5,transactions12m:38,resources:['Lender Intros','Buyer Workshops','Offer Playbooks'],brokerageMarketing:4,domVsArea:0,spLpVsArea:0.0,buyDiscountVsArea:1.0},
      {id:'A4',alias:'Luxury Lakefront Team',neighborhoods:['Gold Coast','Streeterville','Old Town'],propertyTypes:['Condo','Single Family'],priceMin:1200000,priceMax:6000000,focus:'Seller',marketing:5,negotiation:4,transactions12m:29,resources:['International Network','Print Features','Private Showings'],brokerageMarketing:5,domVsArea:-6,spLpVsArea:1.6,buyDiscountVsArea:0.0},
      {id:'A5',alias:'Northwest Bungalow Expert',neighborhoods:['Irving Park','Portage Park','Jefferson Park'],propertyTypes:['Single Family'],priceMin:350000,priceMax:900000,focus:'Seller',marketing:4,negotiation:4,transactions12m:31,resources:['Contractor Rolodex','Floorplan Maps','Neighborhood Groups'],brokerageMarketing:4,domVsArea:-4,spLpVsArea:0.6,buyDiscountVsArea:0.0},
      {id:'A6',alias:'South Loop Buyers',neighborhoods:['South Loop','Printers Row'],propertyTypes:['Condo','Loft'],priceMin:350000,priceMax:1000000,focus:'Buyer',marketing:3,negotiation:5,transactions12m:26,resources:['New Build Access','HOA Intel','Inspection Playbook'],brokerageMarketing:4,domVsArea:0,spLpVsArea:0.0,buyDiscountVsArea:0.7},
      {id:'A7',alias:'North Shore Seller Strategist',neighborhoods:['Winnetka','Glencoe','Evanston','Wilmette'],propertyTypes:['Single Family'],priceMin:900000,priceMax:3500000,focus:'Seller',marketing:5,negotiation:4,transactions12m:34,resources:['Staging','Aerial Video','Broker Network'],brokerageMarketing:5,domVsArea:-8,spLpVsArea:1.3,buyDiscountVsArea:0.0},
      {id:'A8',alias:'Investors & 2-4 Units',neighborhoods:['Logan Square','Avondale','Humboldt Park'],propertyTypes:['Multi-Unit'],priceMin:400000,priceMax:1200000,focus:'Buyer',marketing:3,negotiation:5,transactions12m:22,resources:['Rent Rolls','Cap Rate Models','Off-Market Leads'],brokerageMarketing:3,domVsArea:0,spLpVsArea:0.0,buyDiscountVsArea:1.3},
      {id:'A9',alias:'Hinsdale & Western Suburbs',neighborhoods:['Hinsdale','Clarendon Hills','Western Springs'],propertyTypes:['Single Family'],priceMin:800000,priceMax:2500000,focus:'Seller',marketing:5,negotiation:4,transactions12m:36,resources:['School Guides','Luxury Print','Buyer Pools'],brokerageMarketing:5,domVsArea:-5,spLpVsArea:1.1,buyDiscountVsArea:0.0},
      {id:'A10',alias:'Edgewater/Rogers Park Condos',neighborhoods:['Edgewater','Rogers Park'],propertyTypes:['Condo'],priceMin:200000,priceMax:500000,focus:'Buyer',marketing:3,negotiation:5,transactions12m:28,resources:['Assessment Intel','Transit Access','HOA Docs'],brokerageMarketing:3,domVsArea:0,spLpVsArea:0.0,buyDiscountVsArea:0.9}
    ];

    /* Scoring */
    const METRICS={neighborhood:{label:'Neighborhood specialization',weight:{Buyer:.22,Seller:.18}},productType:{label:'Product type fit',weight:{Buyer:.12,Seller:.12}},priceBand:{label:'Price band fit',weight:{Buyer:.12,Seller:.12}},roleFocus:{label:'Buyer/Seller focus',weight:{Buyer:.10,Seller:.10}},resources:{label:'Resources to achieve goals',weight:{Buyer:.18,Seller:.22}},brokerage:{label:'Brokerage marketing power',weight:{Buyer:.08,Seller:.12}},trackRecord:{label:'Success & track record',weight:{Buyer:.18,Seller:.14}}};
    const clamp=(x,a=0,b=1)=>Math.max(a,Math.min(b,x));
    function overlapRatio(range,aMin,aMax){ const [pMin,pMax]=range||[0,0]; const inter=Math.max(0,Math.min(pMax,aMax)-Math.max(pMin,aMin)); const uni=Math.max(pMax,aMax)-Math.min(pMin,aMin); return uni>0?inter/uni:0 }
    function scoreAgent(agent,answers){
      const role=answers.role||'Buyer';
      const neighborhood=answers.location?(agent.neighborhoods.some(n=>n.toLowerCase().includes(answers.location.toLowerCase()))?1:0):.5;
      const productType=answers.propertyType?(agent.propertyTypes.includes(answers.propertyType)?1:0):.5;
      const priceBand=overlapRatio(answers.priceRange,agent.priceMin,agent.priceMax)||.5;
      const roleFocus=answers.role?(answers.role===agent.focus?1:0):.5;
      const m=agent.marketing/5, n=agent.negotiation/5;
      const wantsM=(answers.priorities||[]).includes('Marketing Power'), wantsN=(answers.priorities||[]).includes('Negotiation Strength');
      const resources=role==='Seller'?clamp(.7*m+.3*n+(wantsM? .1:0)):clamp(.7*n+.3*m+(wantsN? .1:0));
      const brokerage=agent.brokerageMarketing/5;
      const activity=Math.min(agent.transactions12m,50)/50;
      const domScore=role==='Seller'?clamp(.5+(-agent.domVsArea)/30):.5;
      const spLpScore=role==='Seller'?clamp((agent.spLpVsArea+3)/6):.5;
      const buyerDiscount=role==='Buyer'?clamp((agent.buyDiscountVsArea+2)/4):.5;
      const performance=role==='Seller'?clamp(.6*spLpScore+.4*domScore):buyerDiscount;
      const trackRecord=clamp(.6*performance+.4*activity);
      const raw={neighborhood,productType,priceBand,roleFocus,resources,brokerage,trackRecord};
      const parts=Object.entries(METRICS).map(([k,d])=>{ const w=d.weight[role], s=raw[k]??0; return {id:k,label:d.label,weight:w,score:s,points:Math.round(s*w*100)} });
      const total=parts.reduce((s,p)=>s+p.points,0);
      return { total, parts, raw }
    }
    function narrative(agent,answers){
      const bullets=[];
      if(answers.location){
        const locs=agent.neighborhoods.filter(n=>n.toLowerCase().includes(answers.location.toLowerCase())).slice(0,2).join(', ');
        if(locs) bullets.push('Specializes near '+locs+'.');
      }
      if(answers.propertyType) bullets.push('Primary focus: '+answers.propertyType+'.');
      if(answers.priceRange) bullets.push('Comfortable in your price window ($'+Number(answers.priceRange[0]).toLocaleString()+'–$'+Number(answers.priceRange[1]).toLocaleString()+').');
      if(answers.role) bullets.push(agent.focus+'-oriented strategies.');
      if((answers.priorities||[]).includes('Marketing Power')) bullets.push('Strong marketing: '+agent.resources.slice(0,2).join(', ')+'.');
      if((answers.priorities||[]).includes('Negotiation Strength')) bullets.push('Known for sharp negotiations.');
      bullets.push(agent.transactions12m+' closings in last 12 months.');
      return bullets
    }

    /* Questionnaire state */
    const state={role:'',location:'',propertyType:'',priceRange:[400000,1000000],priorities:[],timing:'0-3 months'};
    const stepEls=[...Array(6)].map((_,i)=>document.getElementById('step-'+i));
    const nextBtn=document.getElementById('btn-next'), backBtn=document.getElementById('btn-back'), finishBtn=document.getElementById('btn-finish');
    const progressBar=document.getElementById('progress-bar'), stepNum=document.getElementById('step-num');
    const PROPERTY_TYPES=['Condo','Single Family','Townhome','Loft','Multi-Unit'];
    const PRIORITIES=['Local Expertise','Marketing Power','Negotiation Strength','New Construction Access','Off-Market Access'];
    let step=0;

    function renderPropertyTypeButtons(){
      const holder=document.getElementById('property-types'); holder.innerHTML='';
      PROPERTY_TYPES.forEach(pt=>{
        const b=document.createElement('button'); b.className='card'; b.style.padding='12px'; b.textContent=pt; b.style.textAlign='left';
        b.onclick=()=>{ state.propertyType=pt }; holder.appendChild(b);
      });
    }
    function renderPriorityCheckboxes(){
      const holder=document.getElementById('priorities'); holder.innerHTML='';
      PRIORITIES.forEach(p=>{
        const w=document.createElement('label'); w.className='card'; w.style.padding='12px'; w.innerHTML='<input type="checkbox" style="margin-right:8px;">'+p;
        const cb=w.querySelector('input');
        cb.onchange=()=>{ if(cb.checked){ if(!state.priorities.includes(p)) state.priorities.push(p) } else { state.priorities=state.priorities.filter(x=>x!==p) } };
        holder.appendChild(w);
      });
    }
    function goStep(n){
      step=n; stepEls.forEach((el,i)=>el.classList.toggle('hidden',i!==step));
      stepNum.textContent=(step+1); progressBar.style.width=((step+1)/6*100)+'%';
      backBtn.disabled=(step===0); nextBtn.classList.toggle('hidden',step===5); finishBtn.classList.toggle('hidden',step!==5);
    }
    document.querySelectorAll('[data-role]').forEach(btn=>{ btn.onclick=()=>{ state.role=btn.getAttribute('data-role'); goStep(1) } });
    document.getElementById('input-location').oninput=(e)=>{ state.location=e.target.value||'' };
    document.getElementById('price-min').oninput=(e)=>{ state.priceRange[0]=+e.target.value||0 };
    document.getElementById('price-max').oninput=(e)=>{ state.priceRange[1]=+e.target.value||0 };
    document.querySelectorAll('.timing').forEach(btn=>{ btn.onclick=()=>{ state.timing=btn.getAttribute('data-val') } });
    backBtn.onclick=()=>{ if(step>0) goStep(step-1) };
    nextBtn.onclick=()=>{ if(step<5) goStep(step+1) };
    finishBtn.onclick=()=>{ document.getElementById('results').classList.remove('hidden'); window.location.hash='#results'; renderResults() };
    renderPropertyTypeButtons(); renderPriorityCheckboxes(); goStep(0);

    /* Results */
    function renderResults(){
      const sc=AGENTS.map(a=>({agent:a,score:scoreAgent(a,state),bullets:narrative(a,state)})).sort((x,y)=>y.score.total-x.score.total);
      const top3=sc.slice(0,3), rest=sc.slice(3,10);
      const topEl=document.getElementById('top3'); topEl.innerHTML='';
      const restEl=document.getElementById('rest'); restEl.innerHTML='';
      top3.forEach(r=>topEl.appendChild(renderAgentCard(r)));
      rest.forEach(r=>restEl.appendChild(renderAgentSmall(r)));
    }
    function renderAgentCard(r){
      const wrap=document.createElement('div'); wrap.className='card'; wrap.style.padding='14px';
      const head=document.createElement('div'); head.style.display='flex'; head.style.justifyContent='space-between'; head.style.alignItems='center';
      head.innerHTML='<div><div class="xsmall">Top Match</div><div class="h3">'+r.agent.alias+'</div></div><div style="text-align:right;"><div style="font-size:24px; font-weight:800;">'+r.score.total+'</div><div class="xsmall">Fit score</div></div>';
      wrap.appendChild(head);
      const ul=document.createElement('ul'); ul.className='list small'; ul.style.marginTop='8px';
      r.bullets.forEach(b=>{ const li=document.createElement('li'); li.textContent=b; ul.appendChild(li) }); wrap.appendChild(ul);

      const ctrl=document.createElement('div'); ctrl.style.display='flex'; ctrl.style.gap='14px'; ctrl.style.marginTop='8px';
      const why=document.createElement('button'); why.className='small'; why.style.textDecoration='underline'; why.style.border=0; why.style.background='transparent'; why.textContent='Why this match?';
      const met=document.createElement('button'); met.className='small'; met.style.textDecoration='underline'; met.style.border=0; met.style.background='transparent'; met.textContent='View metrics';
      ctrl.appendChild(why); ctrl.appendChild(met); wrap.appendChild(ctrl);

      const whyBox=document.createElement('div'); whyBox.className='card'; whyBox.style.padding='10px'; whyBox.style.background='#f8fafc'; whyBox.style.marginTop='6px'; whyBox.style.display='none';
      const whyList=document.createElement('div'); whyList.className='xsmall';
      r.score.parts.forEach(p=>{ const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.margin='4px 0';
        row.innerHTML='<span>'+p.label+'</span><span class="tabular">'+Math.round(p.score*100)+'% × '+Math.round(p.weight*100)+'% = <strong>'+p.points+'</strong></span>'; whyList.appendChild(row); });
      whyBox.appendChild(whyList); wrap.appendChild(whyBox);

      const metBox=document.createElement('div'); metBox.className='card'; metBox.style.padding='10px'; metBox.style.background='#f8fafc'; metBox.style.marginTop='6px'; metBox.style.display='none';
      metBox.innerHTML='<div class="grid-3 small"><div><div class="xsmall">Transactions (12m)</div><div class="h3">'+r.agent.transactions12m+'</div></div><div><div class="xsmall">DOM vs Area (seller)</div><div class="h3">'+r.agent.domVsArea+' days</div></div><div><div class="xsmall">SP/LP Δ vs Area (seller)</div><div class="h3">'+r.agent.spLpVsArea+'%</div></div><div><div class="xsmall">Buyer Price Δ vs Area</div><div class="h3">'+r.agent.buyDiscountVsArea+'%</div></div><div><div class="xsmall">Marketing</div><div class="h3">'+r.agent.marketing+'/5</div></div><div><div class="xsmall">Negotiation</div><div class="h3">'+r.agent.negotiation+'/5</div></div><div><div class="xsmall">Brokerage Marketing</div><div class="h3">'+r.agent.brokerageMarketing+'/5</div></div><div style="grid-column:1 / -1;"><div class="xsmall">Neighborhoods</div><div class="small"><strong>'+r.agent.neighborhoods.join(', ')+'</strong></div></div></div>';
      wrap.appendChild(metBox);

      why.onclick=()=>{ whyBox.style.display=(whyBox.style.display==='none'?'block':'none') };
      met.onclick=()=>{ metBox.style.display=(metBox.style.display==='none'?'block':'none') };

      const pillbar=document.createElement('div'); pillbar.className='pillbar'; pillbar.style.marginTop='8px';
      r.agent.propertyTypes.forEach(t=>{ const s=document.createElement('span'); s.className='chip'; s.textContent=t; pillbar.appendChild(s) });
      const f=document.createElement('span'); f.className='chip'; f.textContent=r.agent.focus+' focus'; pillbar.appendChild(f);
      wrap.appendChild(pillbar);

      const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='10px'; actions.style.marginTop='10px';
      const btnChat=document.createElement('button'); btnChat.className='btn'; btnChat.textContent='Open anonymous chat';
      const btnSave=document.createElement('button'); btnSave.className='btn btn-outline'; btnSave.textContent='Save for later';
      actions.appendChild(btnChat); actions.appendChild(btnSave); wrap.appendChild(actions);
      btnChat.onclick=()=>openChat(r.agent);

      const note=document.createElement('div'); note.className='xsmall'; note.style.marginTop='6px'; note.textContent='No names or contact details shown. If both sides opt-in, we’ll connect you directly.';
      wrap.appendChild(note);
      return wrap
    }
    function renderAgentSmall(r){
      const wrap=document.createElement('div'); wrap.className='card'; wrap.style.padding='12px';
      const head=document.createElement('div'); head.style.display='flex'; head.style.justifyContent='space-between';
      head.innerHTML='<div class="small" style="font-weight:700;">'+r.agent.alias+'</div><div class="small" style="font-weight:700;">'+r.score.total+'</div>'; wrap.appendChild(head);
      const ul=document.createElement('ul'); ul.className='list xsmall'; ul.style.marginTop='6px';
      r.bullets.slice(0,3).forEach(b=>{ const li=document.createElement('li'); li.textContent=b; ul.appendChild(li) }); wrap.appendChild(ul);
      const btn=document.createElement('button'); btn.className='btn'; btn.style.width='100%'; btn.style.marginTop='8px'; btn.textContent='Chat anonymously';
      btn.onclick=()=>openChat(r.agent); wrap.appendChild(btn);
      return wrap
    }

    /* Chat controls */
    const modal=document.getElementById('chat-modal'), chatClose=document.getElementById('chat-close'), chatMin=document.getElementById('chat-min'), chatFab=document.getElementById('chat-fab');
    function openChat(agent){
      document.getElementById('chat-title').textContent=agent.alias;
      const msgs=document.getElementById('chat-messages'); msgs.innerHTML='';
      const seed=[{who:'system',text:"Anonymous chat created. Share only what you're comfortable with."},{who:agent.alias,text:`Hi there! I can advise on ${(state.propertyType||'your goals').toLowerCase()} in ${state.location || 'your area'}.`}];
      seed.forEach(m=>appendMsg(m.who,m.text)); showModal();
    }
    function showModal(){ modal.classList.remove('hidden'); modal.setAttribute('aria-hidden','false'); document.getElementById('chat-input').focus() }
    function hideModal(){ modal.classList.add('hidden'); modal.setAttribute('aria-hidden','true') }
    function appendMsg(who,text){
      const box=document.createElement('div'); box.className='card'; box.style.padding='8px 10px'; box.style.maxWidth='80%'; box.style.margin='6px 0';
      if(who==='You'){ box.style.marginLeft='auto'; box.style.background='#111827'; box.style.color='#fff' }
      const whoEl=document.createElement('div'); whoEl.className='xsmall'; whoEl.textContent=who;
      const textEl=document.createElement('div'); textEl.className='small'; textEl.style.marginTop='4px'; textEl.textContent=text;
      box.appendChild(whoEl); box.appendChild(textEl);
      const msgs=document.getElementById('chat-messages'); msgs.appendChild(box); msgs.scrollTop=msgs.scrollHeight;
    }
    document.getElementById('chat-send').onclick=()=>{ const inp=document.getElementById('chat-input'); const t=(inp.value||'').trim(); if(!t) return; appendMsg('You',t); inp.value='' };
    chatClose.onclick=hideModal; chatMin.onclick=hideModal;
    modal.addEventListener('click',e=>{ if(e.target===modal) hideModal() });
    document.addEventListener('keydown',e=>{ if(e.key==='Escape') hideModal() });
    chatFab.onclick=()=>{ if(modal.classList.contains('hidden')){ document.getElementById('chat-title').textContent='Agent'; const msgs=document.getElementById('chat-messages'); msgs.innerHTML=''; appendMsg('system',"Anonymous chat created. Share only what you're comfortable with."); showModal() } else { hideModal() } };

    /* CSV pilot */
    document.getElementById('load-sample').onclick=()=>{ const sample=`id,alias,neighborhoods,propertyTypes,priceMin,priceMax,focus,marketing,negotiation,transactions12m,resources,brokerageMarketing,domVsArea,spLpVsArea,buyDiscountVsArea
X1,West Loop Condo Pro,West Loop;River North,Condo;Loft,600000,1600000,Seller,5,3,48,3D Tours;Broker Events;Pro Video,5,-8,1.1,0
X2,North Shore Seller Strategist,Winnetka;Glencoe;Evanston;Wilmette,Single Family,900000,3500000,Seller,5,4,34,Staging;Aerial Video;Broker Network,5,-8,1.3,0
X3,First-Time Buyer Guide,Lincoln Square;Ravenswood;Logan Square,Condo;Townhome,300000,800000,Buyer,3,5,38,Lender Intros;Buyer Workshops;Offer Playbooks,4,0,0,1.0`; document.getElementById('csv').value=sample; document.getElementById('status').textContent='Loaded sample. You can modify before importing.' };
    document.getElementById('import').onclick=()=>{ try{ const txt=document.getElementById('csv').value||''; const lines=txt.trim().split(/\r?\n/); if(lines.length<2){ document.getElementById('status').textContent='No rows detected. Check your CSV.'; return } const headers=lines[0].split(',').map(h=>h.trim()); const rows=[]; for(let i=1;i<lines.length;i++){ if(!lines[i].trim()) continue; const cols=lines[i].split(',').map(c=>c.trim()); const obj={}; headers.forEach((h,idx)=>obj[h]=cols[idx]??''); const toList=v=>v?v.split(/;|\|/).map(x=>x.trim()).filter(Boolean):[]; rows.push({ id:obj.id||'R'+i, alias:obj.alias||('Agent '+i), neighborhoods:toList(obj.neighborhoods), propertyTypes:toList(obj.propertyTypes), priceMin:parseFloat(obj.priceMin||0), priceMax:parseFloat(obj.priceMax||0), focus:(obj.focus||'Seller').trim(), marketing:parseInt(obj.marketing||3), negotiation:parseInt(obj.negotiation||3), transactions12m:parseInt(obj.transactions12m||0), resources:toList(obj.resources), brokerageMarketing:parseInt(obj.brokerageMarketing||3), domVsArea:parseFloat(obj.domVsArea||0), spLpVsArea:parseFloat(obj.spLpVsArea||0), buyDiscountVsArea:parseFloat(obj.buyDiscountVsArea||0) }) } AGENTS=rows; document.getElementById('status').textContent='Imported '+rows.length+' agents. Matches now use your data.'; document.getElementById('results').classList.remove('hidden'); renderResults(); window.location.hash='#results' } catch(e){ document.getElementById('status').textContent='Import error. Please check formatting.' } };
    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
</body>
</html>
